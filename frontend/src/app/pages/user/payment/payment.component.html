<!--
Vista del simulador de pago:
- Muestra una pantalla inicial para iniciar el pago.
- Formulario para ingresar datos de la tarjeta (número, CVV, titular) con validaciones.
- Muestra mensajes de éxito o error según el resultado del pago.
- Si el pago es exitoso, muestra un comprobante con los datos de la transacción.
-->
<div class="container-fluid min-vh-100 d-flex align-items-center justify-content-center" 
     style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 50%, #90caf9 100%);">
  
  <div class="row w-100 justify-content-center">
    <div class="col-12 col-md-8 col-lg-6 col-xl-5">
      
      @if (currentStep === 'initial') {
      <div class="card shadow-lg border-0">
        <div class="card-body text-center p-5" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);">
          <div class="mb-4">
            <i class="fas fa-credit-card text-primary" style="font-size: 4rem; color: #1976d2 !important;"></i>
          </div>
          <h2 class="card-title mb-4" style="color: #1565c0;">Simulador de Pago</h2>
          <p class="card-text mb-4 text-muted">
            Simula el proceso de pago con tarjeta de crédito o débito de forma segura
          </p>
          <button class="btn btn-primary btn-lg px-5 py-3" 
                  (click)="showPaymentForm()"
                  style="background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); border: none; box-shadow: 0 4px 15px rgba(25, 118, 210, 0.3);">
            <i class="fas fa-credit-card me-2"></i>
            Pagar con Tarjeta
          </button>
        </div>
      </div>
      }

      @if (currentStep === 'payment-form') {
      <div class="card shadow-lg border-0">
        <div class="card-header text-center py-4" style="background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); color: white; border: none;">
          <h3 class="mb-0">
            <i class="fas fa-credit-card me-2"></i>
            Datos de la Tarjeta
          </h3>
        </div>
        <div class="card-body p-5" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);">
          <form (ngSubmit)="processPayment()">
            
            <!-- Número de tarjeta -->
            <div class="mb-4">
              <label for="cardNumber" class="form-label fw-bold" style="color: #1565c0;">
                <i class="fas fa-credit-card me-2"></i>
                Número de Tarjeta
              </label>
              <input type="text" 
                     id="cardNumber"
                     class="form-control form-control-lg" 
                     [class.is-invalid]="errors.cardNumber"
                     placeholder="0000 0000 0000 0000"
                     [(ngModel)]="cardData.cardNumber"
                     name="cardNumber"
                     (input)="formatCardNumber($event)"
                     (keypress)="preventNonNumericCard($event)"
                     maxlength="19">
              @if (errors.cardNumber) {
              <div class="invalid-feedback">
                {{ errors.cardNumber }}
              </div>
              }
            </div>

            <!-- CVV -->
            <div class="mb-4">
              <label for="cvv" class="form-label fw-bold" style="color: #1565c0;">
                <i class="fas fa-lock me-2"></i>
                CVV
              </label>
              <input type="text" 
                     id="cvv"
                     class="form-control form-control-lg" 
                     [class.is-invalid]="errors.cvv"
                     placeholder="123"
                     [(ngModel)]="cardData.cvv"
                     name="cvv"
                     (input)="formatCvv($event)"
                     (keypress)="preventNonNumericCvv($event)"
                     maxlength="3">
              @if (errors.cvv) {
              <div class="invalid-feedback">
                {{ errors.cvv }}
              </div>
              }
            </div>

            <!-- Nombre del titular -->
            <div class="mb-4">
              <label for="cardholderName" class="form-label fw-bold" style="color: #1565c0;">
                <i class="fas fa-user me-2"></i>
                Nombre del Titular
              </label>
              <input type="text" 
                     id="cardholderName"
                     class="form-control form-control-lg" 
                     [class.is-invalid]="errors.cardholderName"
                     placeholder="Juan Pérez"
                     [(ngModel)]="cardData.cardholderName"
                     name="cardholderName"
                     (input)="formatCardholderName($event)"
                     (keypress)="preventNonAlphabetic($event)">
              @if (errors.cardholderName) {
              <div class="invalid-feedback">
                {{ errors.cardholderName }}
              </div>
              }
            </div>

            <!-- Botones -->
            <div class="d-grid gap-3">
              <button type="submit" 
                      class="btn btn-primary btn-lg py-3"
                      style="background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); border: none; box-shadow: 0 4px 15px rgba(25, 118, 210, 0.3);">
                <i class="fas fa-check me-2"></i>
                Procesar Pago
              </button>
              <button type="button" 
                      class="btn btn-outline-secondary btn-lg py-3"
                      (click)="goToInitial()">
                <i class="fas fa-arrow-left me-2"></i>
                Volver
              </button>
            </div>
          </form>
        </div>
      </div>
      }

      @if (currentStep === 'success') {
      <div class="card shadow-lg border-0">
        <div class="card-header text-center py-4" style="background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%); color: white; border: none;">
          <h3 class="mb-0">
            <i class="fas fa-check-circle me-2"></i>
            ¡Pago Exitoso!
          </h3>
        </div>
        <div class="card-body p-5" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);">
          
          <!-- Boleta -->
          <div class="receipt-container mb-4 p-4 border rounded" style="background: #f8f9fa; border-color: #dee2e6 !important;">
            <div class="text-center mb-3">
              <h4 class="text-success mb-2">
                <i class="fas fa-receipt me-2"></i>
                Comprobante de Pago
              </h4>
              <div class="text-muted small">{{ receiptData.transactionId }}</div>
            </div>
            
            <div class="row">
              <div class="col-6">
                <strong>Comercio:</strong><br>
                <span class="text-muted">{{ receiptData.merchant }}</span>
              </div>
              <div class="col-6 text-end">
                <strong>Fecha:</strong><br>
                <span class="text-muted">{{ receiptData.date | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>
            </div>
            
            <hr class="my-3">
            
            <div class="row mb-2">
              <div class="col-8">
                <strong>Descripción:</strong>
              </div>
              <div class="col-4 text-end">
                <strong>Monto:</strong>
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-8">
                <span class="text-muted">{{ receiptData.description }}</span>
              </div>
              <div class="col-4 text-end">
                <span class="fw-bold text-success">${{ receiptData.amount.toLocaleString() }}</span>
              </div>
            </div>
            
            <hr class="my-3">
            
            <div class="row">
              <div class="col-6">
                <strong>Tarjeta:</strong><br>
                <span class="text-muted">**** **** **** {{ receiptData.cardLastDigits }}</span>
              </div>
              <div class="col-6 text-end">
                <strong>Estado:</strong><br>
                <span class="badge bg-success">APROBADO</span>
              </div>
            </div>
            
            <div class="text-center mt-3">
              <small class="text-muted">
                <i class="fas fa-shield-alt me-1"></i>
                Transacción procesada de forma segura
              </small>
            </div>
          </div>
          
          <p class="text-center text-muted mb-4">{{ successMessage }}</p>
          
          <div class="d-grid">
            <button class="btn btn-success btn-lg px-5 py-3" 
                    (click)="goToInitial()"
                    style="background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%); border: none; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);">
              <i class="fas fa-home me-2"></i>
              Aceptar
            </button>
          </div>
        </div>
      </div>
      }

      @if (currentStep === 'error') {
      <div class="card shadow-lg border-0">
        <div class="card-body text-center p-5" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);">
          <div class="mb-4">
            <i class="fas fa-exclamation-triangle text-danger" style="font-size: 4rem; color: #f44336 !important;"></i>
          </div>
          <h3 class="card-title mb-4 text-danger">Error en el Pago</h3>
          <p class="card-text mb-4 text-muted">{{ errorMessage }}</p>
          <button class="btn btn-danger btn-lg px-5 py-3" 
                  (click)="goToInitial()"
                  style="background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%); border: none; box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);">
            <i class="fas fa-home me-2"></i>
            Aceptar
          </button>
        </div>
      </div>
      }

    </div>
  </div>
</div>
