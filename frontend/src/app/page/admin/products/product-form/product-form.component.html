<div class="container mt-4">
    <h3>Agregar Nuevo Producto</h3>
    <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
  
      <!-- Nombre -->
      <div class="mb-3">
        <label class="form-label">Nombre *</label>
        <input class="form-control" formControlName="nombre" />
      </div>
  
      <!-- Precio -->
      <div class="mb-3">
        <label class="form-label">Precio *</label>
        <input type="number" class="form-control" formControlName="precio" />
      </div>
  
      <!-- Categoría -->
      <div class="mb-3">
        <label class="form-label">Categoría *</label>
        <select class="form-select" formControlName="categoriaId">
          <option value="">Seleccione una categoría</option>
          @for (cat of categorias; track cat.id) {
            <option [value]="cat.id">{{ cat.nombre }}</option>
          }
        </select>
      </div>
  
      <!-- Descripción -->
      <div class="mb-3">
        <label class="form-label">Descripción *</label>
        <textarea class="form-control" formControlName="descripcion" rows="3"></textarea>
      </div>
  
      <!-- Imagen -->
      <div class="mb-3">
        <label class="form-label">URL Imagen</label>
        <input class="form-control" formControlName="imagenUrl" />
      </div>
  
      <!-- Sucursales -->
      <div class="card mt-4">
        <div class="card-header d-flex justify-content-between align-items-center">
          <strong>Sucursales y Stock</strong>
          <button type="button" class="btn btn-primary btn-sm" (click)="agregarSucursal()"
            [disabled]="sucursalesSeleccionadas.length >= sucursales.length">
            + Agregar Sucursal
          </button>
        </div>
  
        <div class="card-body" formArrayName="sucursalesSeleccionadas">
          @for (sucursalForm of sucursalesSeleccionadas.controls; track $index) {
            <div [formGroupName]="$index" class="mb-3 row">
              <div class="col-md-6">
                <label class="form-label">Sucursal *</label>
                <select class="form-select" formControlName="sucursalId" required>
                  <option value="">Seleccione una sucursal</option>
                  <option *ngFor="let s of obtenerSucursalesDisponiblesParaSelect($index)" [value]="s.sucursalId">
                    {{ s.nombre }} - {{ s.ciudad }}
                  </option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Stock *</label>
                <input type="number" class="form-control" formControlName="stock" />
              </div>
              <div class="col-md-2 d-flex align-items-end">
                <button type="button" class="btn btn-danger w-100" (click)="removerSucursal($index)">Eliminar</button>
              </div>
            </div>
          }
        </div>
      </div>
  
      <!-- Mensajes -->
      @if (mensajeError) {
        <div class="alert alert-danger mt-3">{{ mensajeError }}</div>
      }
      @if (mensajeExito) {
        <div class="alert alert-success mt-3">{{ mensajeExito }}</div>
      }
  
      <!-- Botones -->
      <div class="mt-4 d-flex justify-content-between">
        <button type="button" class="btn btn-secondary"
          (click)="productForm.reset(); sucursalesSeleccionadas.clear();">
          Limpiar Formulario
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="loading || productForm.invalid">
          {{ loading ? 'Agregando...' : 'Agregar Producto' }}
        </button>
      </div>
    </form>
  </div>
  