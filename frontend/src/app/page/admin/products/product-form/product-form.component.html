<div class="container mt-4">
    <h3>Agregar Nuevo Producto</h3>
    <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
  
      <!-- Sección: Nombre del producto -->
      <div class="mb-3">
        <label class="form-label">Nombre del producto</label>
        <input class="form-control" formControlName="nombre" placeholder="Ingrese nombre del producto" />
      </div>
  
      <!-- Sección: Precio del producto -->
      <div class="mb-3">
        <label class="form-label">Precio del producto</label>
        <input type="number" class="form-control" formControlName="precio" placeholder="Ingrese precio del producto"/>
      </div>
  
      <!-- Sección: Oferta del producto (opcional) -->
      <div class="mb-3">
        <label class="form-label">Oferta (opcional)</label>
        <input class="form-control" formControlName="oferta" placeholder="en breve modificaciones" />
      </div>
  
      <!-- Sección: Categoría del producto -->
      <div class="mb-3">
        <label class="form-label">Categoría</label>
        <select class="form-select" formControlName="categoriaId">
          <option value=""disabled selected>Seleccione una categoría</option>
          @for (cat of categorias; track cat.id) {
            <option [value]="cat.id">{{ cat.nombre }}</option>
          }
        </select>
      </div>
  
      <!-- Sección: Descripción del producto -->
      <div class="mb-3">
        <label class="form-label">Descripción del producto</label>
        <textarea class="form-control" formControlName="descripcion" rows="3" placeholder="Ingrese descripcion del producto"></textarea>
      </div>
  
      <!-- Sección: Imagen del producto -->
      <div class="mb-3">
        <label class="form-label">Imagen del producto</label>
        <input class="form-control" formControlName="imagenUrl" placeholder="Ingrese URL de la imagen del producto" />
      </div>
  
      <!-- Sección: Sucursales y stock asociados al producto -->
      <div class="card mt-4">
        <div class="card-header d-flex justify-content-between align-items-center">
          <strong>Sucursales y Stock</strong>
          <!-- Botón para agregar una nueva sucursal al producto -->
          <button type="button" class="btn btn-primary btn-sm" (click)="agregarSucursal()"
            [disabled]="sucursalesSeleccionadas.length >= sucursales.length">
            + Agregar Sucursal
          </button>
        </div>
  
        <div class="card-body" formArrayName="sucursalesSeleccionadas">
          <!-- Itera sobre cada sucursal seleccionada para el producto -->
          @for (sucursalForm of sucursalesSeleccionadas.controls; track $index) {
            <div [formGroupName]="$index" class="mb-3 row">
              <div class="col-md-6">
                <label class="form-label">Sucursal</label>
                <!-- Select para elegir la sucursal, solo muestra las disponibles -->
                <select class="form-select" formControlName="id" required>
                  <option value="" disabled selected>Seleccione una sucursal</option>
                  @for (sucursales of obtenerSucursalesDisponiblesParaSelect($index); track sucursales.id) {
                    <option [value]="sucursales.id">
                      {{ sucursales.nombre }} - {{ sucursales.ciudad }}
                    </option>
                  }
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Stock</label>
                <input type="number" class="form-control" formControlName="stock" />
              </div>
              <div class="col-md-2 d-flex align-items-end">
                <!-- Botón para eliminar la sucursal de la lista -->
                <button type="button" class="btn btn-danger w-100" (click)="removerSucursal($index)">Eliminar</button>
              </div>
            </div>
          }
        </div>
      </div>
  
      <!-- Sección: Mensajes de error y éxito -->
      @if (mensajeError) {
        <div class="alert alert-danger mt-3">{{ mensajeError }}</div>
      }
      @if (mensajeExito) {
        <div class="alert alert-success mt-3">{{ mensajeExito }}</div>
      }
  
      <!-- Sección: Botones de acción del formulario -->
      <div class="mt-4 d-flex justify-content-between">
        <button type="button" class="btn btn-secondary"
          (click)="productForm.reset(); sucursalesSeleccionadas.clear();">
          Limpiar Formulario
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="loading || productForm.invalid">
          {{ loading ? 'Agregando...' : 'Agregar Producto' }}
        </button>
      </div>
    </form>
  </div>
  